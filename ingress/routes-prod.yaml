http:
  routers:
    plants-app:
      rule: "Host(`api.plantdex.app`) && PathPrefix(`/plants`)"
      service: plants-app
      middlewares:
        - "redirect-https"
        - "base-headers"
        - "plants-app-headers"
        - "gzip"
      tls:
        certResolver: default
        options: default
    users-app:
      rule: "Host(`api.plantdex.app`) && PathPrefix(`/users`)"
      service: plants-app
      middlewares:
        - "redirect-https"
        - "base-headers"
        - "users-app-headers"
        - "gzip"
      tls:
        certResolver: default
        options: default
    web-app:
      rule: "Host(`plantdex.app`) && PathPrefix(`/`)"
      service: web-app
      middlewares:
        - "redirect-https"
        - "base-headers"
        - "web-app-headers"
      tls:
        certResolver: default
        options: default

  services:
    plants-app:
      loadBalancer:
        servers:
          - url: "http://plants-app:4040/"
    users-app:
      loadBalancer:
        servers:
          - url: "http://users-app:4041/"
    web-app:
      loadBalancer:
        servers:
          - url: "http://web-app:3000/"

  middlewares:
    redirect-https:
      redirectScheme:
        scheme: https
        permanent: true
    base-headers:
      headers:
        customResponseHeaders:
          Strict-Transport-Security: "max-age=63072000; includeSubDomains; preload"
          Via: "Traefik"
    plants-app-headers:
      headers:
        customResponseHeaders:
          Access-Control-Allow-Headers: "Content-Type, Origin"
          Access-Control-Allow-Methods: "POST"
          Access-Control-Allow-Origin: "https://plantdex.app"
          Access-Control-Max-Age: "86400"
          Content-Security-Policy: "default-src 'self'"
          Server: "Go"
    users-app-headers:
      headers:
        customResponseHeaders:
          Access-Control-Allow-Headers: "Content-Type, Origin"
          Access-Control-Allow-Methods: "GET, POST, PATCH, DELETE"
          Access-Control-Allow-Origin: "https://plantdex.app"
          Access-Control-Max-Age: "86400"
          Content-Security-Policy: "default-src 'self'"
          Server: "Go"
    web-app-headers:
      headers:
        customResponseHeaders:
          Content-Security-Policy: "default-src 'self' https://api.plantdex.app; style-src 'unsafe-inline'"
          Referrer-Policy: "strict-origin-when-cross-origin"
          Server: "GSS"
          X-Content-Type-Options: "nosniff"
          X-Frame-Options: "SAMEORIGIN"
          X-XSS-Protection: "1; mode=block"
    gzip:
      compress: {}

tls:
  options:
    default:
      minVersion: VersionTLS13
